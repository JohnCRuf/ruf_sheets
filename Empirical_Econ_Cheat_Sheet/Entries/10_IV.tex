\section{Instrumental Variables}

\subsection{The Endogeneity Problem}
If $\E(xu)\neq 0$ (endogeneity), OLS is inconsistent:
\begin{align*}
    \hat\beta_n^{\text{OLS}} \pto \beta + \E(xx')^{-1}\E(xu)\neq\beta.
\end{align*}

\subsection{IV Conditions}
Use instrument $z\in\R^{l+1}$ ($z_0=1$) satisfying: \\
\textbf{Validity:} $\E(zu)=0$ (exogeneity + exclusion). \\
\textbf{Relevance (Rank Condition):} $\E(zx')$ has rank $k+1$. \\
\textbf{Order Condition (necessary):} $l\geq k$ (at least as many instruments as regressors). \\
$l=k$: exactly identified. $l>k$: overidentified.

\subsection{Identification}
From $y=x'\beta+u$ and $\E(zu)=0$: $\E(zy)=\E(zx')\beta$. If $l=k$:
\begin{align*}
    \beta = \E(zx')^{-1}\E(zy).
\end{align*}

\subsection{IV Estimator (Exact Identification)}
\begin{align*}
    \hat\beta_{\text{IV}} = \left(\frac{1}{n}\sum z_ix_i'\right)^{-1}\frac{1}{n}\sum z_iy_i = (Z'X)^{-1}Z'Y.
\end{align*}
Consistent by LLN + CMT.

\subsection{Potential Outcomes Framework for IV}
Exclusion: $y(d,z')=y(d,z'')$ $\forall d,z',z''$. Write $y(d)\equiv y(d,z')$.

Exogeneity: $y(d,z')\perp z|w$ $\forall d,z'$.

Under constant linear treatment effects: $y(d)=x(w,d)'\beta+u$, $\E(u|w)=0$.

Exclusion $\implies$ $\E(u|z,w)=0$, so $\E(zu)=0$.

\subsection{Asymptotic Distribution}
\begin{align*}
    \sqrt{n}(\hat\beta_{\text{IV}}-\beta)\dto N(0,V_{\text{IV}}),
\end{align*}
where in the scalar case with $\E(u^2|z)=\sigma^2$:
$V_{\text{IV}}=\frac{\sigma^2}{\Corr(x,z)^2\Var(x)}$.

\textbf{IV vs.\ OLS efficiency:} If $\E(u|x)=0$, OLS more efficient: $V_{\text{OLS}}=\frac{\sigma^2}{\Var(x)}$.

\subsection{GMM / 2SLS (Overidentification)}
When $l>k$: $\E(zx')$ is $l+1\times k+1$, not square. Use GMM:
\begin{align*}
    \hat\beta_{\text{2SLS}} = (X'P_Z X)^{-1}X'P_Z Y,
\end{align*}
where $P_Z=Z(Z'Z)^{-1}Z'$. Equivalently: regress $X$ on $Z$ (first stage), then $Y$ on $\hat{X}$ (second stage).

\subsection{Overidentification Tests (Sargan/Hansen)}
Test $H_0:\E(zu)=0$. Under homoskedasticity, the F-statistic from regressing $\hat{u}$ on $z$ is asymptotically $\chi^2_{l_2-k_1}$. Rejection $\implies$ invalid instruments or misspecification, but cannot tell which instrument is bad.

\subsection{Must Include Exogenous Regressors in First Stage}
With $x=(x_{-k},x_k)$, endogenous $x_k$, instruments $z=(x_{-k},z_k)$: the first stage \emph{must} regress $x_k$ on \emph{all} of $z$, not just $z_k$.

\textbf{Why:} If you omit $x_{-k}$, the first-stage estimate $\tilde\pi$ suffers OVB:
$\tilde\pi \pto \pi + \frac{\Cov(z_k,x_{-k})}{\Var(z_k)}\delta \neq \pi$.
The 2SLS estimate becomes $\hat\beta_k = \hat\gamma_k/\tilde\pi \pto \beta_k\pi/(\pi+\nu) \neq \beta_k$, where $\hat\gamma_k$ is the reduced-form coefficient.

Intuitively, $\hat{x}_k$ without controls captures variation from $x_{-k}$, violating ceteris paribus.

\subsection{IV Finite Sample Bias}
IV is generally biased in finite samples. With one excluded instrument and one endogenous variable, $\hat\beta_{\text{IV}}$ has \emph{no finite moments}. For proof: $\E[\hat\beta_{\text{IV}}|Z] = \beta + \E\!\left[\frac{\sum z_i u_i}{\sum z_i x_i}\bigg|Z\right]$, and the ratio need not have finite expectation.

\subsection{Hausman Test (Exogeneity)}
Test $H_0:\E(xu)=0$ using both OLS and IV. Under $H_0$, both are consistent; under $H_1$, only IV is. Joint distribution:
\begin{align*}
    \sqrt{n}\!\begin{pmatrix}\hat\beta_{\text{OLS}}-\beta\\\hat\beta_{\text{IV}}-\beta\end{pmatrix} \dto N(0,V_{\text{joint}}).
\end{align*}
Test statistic: $T_n = n(\hat\beta_{\text{IV}}-\hat\beta_{\text{OLS}})'\hat{W}^{-1}(\hat\beta_{\text{IV}}-\hat\beta_{\text{OLS}})\dto\chi^2_k$ under $H_0$, where $\hat{W}$ consistently estimates the variance of the difference.
