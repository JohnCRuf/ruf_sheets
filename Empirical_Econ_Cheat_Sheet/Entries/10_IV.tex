\section{Instrumental Variables}

\subsection{The Endogeneity Problem}
If $\E(xu)\neq 0$ (endogeneity), OLS is inconsistent for $\beta$:
\begin{align*}
    \hat\beta_n^{\text{OLS}} \pto \beta + \E(xx')^{-1}\E(xu)\neq\beta.
\end{align*}

\subsection{IV Conditions}
Use instrument $z\in\R^{l+1}$ ($z_0=1$) satisfying: \\
\textbf{Validity:} $\E(zu)=0$ (exogeneity + exclusion). \\
\textbf{Relevance (Rank Condition):} $\E(zx')$ has rank $k+1$. \\
\textbf{Order Condition (necessary):} $l\geq k$ (at least as many instruments as regressors). \\
When $l=k$, the model is exactly identified; when $l>k$, it is overidentified.

\subsection{Identification}
From $y=x'\beta+u$ and $\E(zu)=0$: $\E(zy)=\E(zx')\beta$. If $l=k$:
\begin{align*}
    \beta = \E(zx')^{-1}\E(zy).
\end{align*}

\subsection{IV Estimator (Exact Identification)}
\begin{align*}
    \hat\beta_{\text{IV}} = \left(\frac{1}{n}\sum z_ix_i'\right)^{-1}\frac{1}{n}\sum z_iy_i = (Z'X)^{-1}Z'Y.
\end{align*}
Consistent by the LLN and CMT.

\subsection{Asymptotic Distribution}
\begin{align*}
    \sqrt{n}(\hat\beta_{\text{IV}}-\beta)\dto N(0,V_{\text{IV}}),
\end{align*}
where in the scalar case with $\E(u^2|z)=\sigma^2$:
$V_{\text{IV}}=\frac{\sigma^2}{\Corr(x,z)^2\Var(x)}$.

\textbf{IV vs.\ OLS efficiency:} If $\E(u|x)=0$, OLS more efficient: $V_{\text{OLS}}=\frac{\sigma^2}{\Var(x)}$.

\subsection{GMM / 2SLS (Overidentification)}
When $l>k$: $\E(zx')$ is $l+1\times k+1$, not square. Use GMM:
\begin{align*}
    \hat\beta_{\text{2SLS}} = (X'P_Z X)^{-1}X'P_Z Y,
\end{align*}
where $P_Z=Z(Z'Z)^{-1}Z'$. Equivalently: regress $X$ on $Z$ (first stage), then $Y$ on $\hat{X}$ (second stage).

\subsection{Overidentification Tests (Sargan/Hansen)}
Test $H_0:\E(zu)=0$. Under $H_0$ and homoskedasticity, the test statistic is $n\times R^2$ from regressing $\hat{u}_i$ on all instruments $z$, distributed $\chi^2_{L-K}$ asymptotically, where $L=$ \# instruments and $K=$ \# endogenous regressors. Rejection implies invalid instruments or misspecification, but we cannot tell which instrument is bad.

\subsection{Must Include Exogenous Regressors in First Stage}
First stage must regress $x_k$ on \emph{all} of $z=(x_{-k},z_k)$. Omitting $x_{-k}$ causes OVB: $\hat\beta_k \pto \beta_k\pi/(\pi+\nu) \neq \beta_k$.

\subsection{LATE Assumptions}
With heterogeneous effects and binary $D,Z$, IV does not identify the ATE. The LATE framework (Imbens \& Angrist, 1994) imposes:
\begin{itemize}[nosep]
\item \textbf{Independence} (A2): $(Y_i(0),Y_i(1),D_i(0),D_i(1))\perp Z_i$.
\item \textbf{Exclusion} (A2): $Y_i(d,z)=Y_i(d)$ $\forall d,z$ (instrument affects $Y$ only through $D$).
\item \textbf{First stage} (A1): $P(D\!=\!1|Z\!=\!1)\neq P(D\!=\!1|Z\!=\!0)$.
\item \textbf{Monotonicity} (A3): $D_i(1)\geq D_i(0)$ $\forall i$ (no defiers). Implied by threshold crossing $D=\mathbf{1}[\mu_D(Z)\geq U_D]$ with $U_D$ abs.\ continuous.
\item \textbf{Regularity} (A4, A5): $\E|Y_d|<\infty$ and $0\!<\!P(D\!=\!1|X)\!<\!1$ (overlap).
\end{itemize}
Monotonicity partitions the population into \textbf{compliers} ($D_i(1)>D_i(0)$), \textbf{always-takers} ($D_i(1)=D_i(0)=1$), and \textbf{never-takers} ($D_i(1)=D_i(0)=0$).

\subsection{LATE Interpretation}
Under the LATE assumptions, the Wald estimand identifies the \textbf{LATE}:
\begin{align*}
    \frac{\E(Y|Z\!=\!1)-\E(Y|Z\!=\!0)}{\E(D|Z\!=\!1)-\E(D|Z\!=\!0)} = \E(Y(1)\!-\!Y(0)|\text{complier}).
\end{align*}
\textbf{Derivation:} By independence/exclusion, only compliers contribute to the numerator (AT/NT cancel, no defiers); denominator $= P(\text{c})$.

\subsection{Equivalence with Latent Variable Model (Vytlacil, 2002)}
Consider the latent variable selection model $Y_d = \mu_d(X,U_d)$, $D = \mathbf{1}[\mu_D(Z)\geq U_D]$ with:
\begin{itemize}[nosep]
\item[(A1)] $\mu_D(Z)$ nondegenerate $|X$ (relevance / first stage).
\item[(A2)] $(U_0,U_D),(U_1,U_D)\perp Z|X$ (independence \& exclusion).
\item[(A3)] $U_D$ abs.\ continuous (implies monotonicity via threshold crossing).
\item[(A4)] $\E|Y_d|<\infty$.
\item[(A5)] $0\!<\!P(D\!=\!1|X)\!<\!1$ (overlap).
\end{itemize}
Vytlacil (2002): (A1)--(A5) $\iff$ LATE assumptions. Breaks down for multivalued treatments.

\subsection{Hausman Test (Exogeneity)}
Test $H_0:\E(xu)=0$ using both OLS and IV. Under $H_0$, both are consistent; under $H_1$, only IV is. Joint distribution:
\begin{align*}
    \sqrt{n}\!\begin{pmatrix}\hat\beta_{\text{OLS}}-\beta\\\hat\beta_{\text{IV}}-\beta\end{pmatrix} \dto N(0,V_{\text{joint}}).
\end{align*}
Test statistic: $T_n = n(\hat\beta_{\text{IV}}-\hat\beta_{\text{OLS}})'\hat{W}^{-1}(\hat\beta_{\text{IV}}-\hat\beta_{\text{OLS}})\dto\chi^2_k$ under $H_0$, where $\hat{W}$ consistently estimates the variance of the difference.
