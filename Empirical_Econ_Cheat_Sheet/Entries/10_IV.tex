\section{Instrumental Variables}

\subsection{The Endogeneity Problem}
If $\E(xu)\neq 0$ (endogeneity), OLS is inconsistent for $\beta$:
\begin{align*}
    \hat\beta_n^{\text{OLS}} \pto \beta + \E(xx')^{-1}\E(xu)\neq\beta.
\end{align*}

\subsection{IV Conditions}
Use instrument $z\in\R^{l+1}$ ($z_0=1$) satisfying: \\
\textbf{Validity:} $\E(zu)=0$ (exogeneity + exclusion). \\
\textbf{Relevance (Rank Condition):} $\E(zx')$ has rank $k+1$. \\
\textbf{Order Condition (necessary):} $l\geq k$ (at least as many instruments as regressors). \\
When $l=k$, the model is exactly identified; when $l>k$, it is overidentified.

\subsection{Identification}
From $y=x'\beta+u$ and $\E(zu)=0$: $\E(zy)=\E(zx')\beta$. If $l=k$:
\begin{align*}
    \beta = \E(zx')^{-1}\E(zy).
\end{align*}

\subsection{IV Estimator (Exact Identification)}
\begin{align*}
    \hat\beta_{\text{IV}} = \left(\frac{1}{n}\sum z_ix_i'\right)^{-1}\frac{1}{n}\sum z_iy_i = (Z'X)^{-1}Z'Y.
\end{align*}
Consistent by the LLN and CMT.

\subsection{Potential Outcomes Framework for IV}
Exclusion: $y(d,z')=y(d,z'')$ $\forall d,z',z''$. Write $y(d)\equiv y(d,z')$.

Exogeneity: $y(d,z')\perp z|w$ $\forall d,z'$.

Under constant linear treatment effects: $y(d)=x(w,d)'\beta+u$, $\E(u|w)=0$.

Exclusion $\implies$ $\E(u|z,w)=0$, so $\E(zu)=0$.

\subsection{Asymptotic Distribution}
\begin{align*}
    \sqrt{n}(\hat\beta_{\text{IV}}-\beta)\dto N(0,V_{\text{IV}}),
\end{align*}
where in the scalar case with $\E(u^2|z)=\sigma^2$:
$V_{\text{IV}}=\frac{\sigma^2}{\Corr(x,z)^2\Var(x)}$.

\textbf{IV vs.\ OLS efficiency:} If $\E(u|x)=0$, OLS more efficient: $V_{\text{OLS}}=\frac{\sigma^2}{\Var(x)}$.

\subsection{GMM / 2SLS (Overidentification)}
When $l>k$: $\E(zx')$ is $l+1\times k+1$, not square. Use GMM:
\begin{align*}
    \hat\beta_{\text{2SLS}} = (X'P_Z X)^{-1}X'P_Z Y,
\end{align*}
where $P_Z=Z(Z'Z)^{-1}Z'$. Equivalently: regress $X$ on $Z$ (first stage), then $Y$ on $\hat{X}$ (second stage).

\subsection{Overidentification Tests (Sargan/Hansen)}
Test $H_0:\E(zu)=0$. Under $H_0$ and homoskedasticity, the test statistic is $n\times R^2$ from regressing $\hat{u}_i$ on all instruments $z$, distributed $\chi^2_{L-K}$ asymptotically, where $L=$ \# instruments and $K=$ \# endogenous regressors. Rejection implies invalid instruments or misspecification, but we cannot tell which instrument is bad.

\subsection{Must Include Exogenous Regressors in First Stage}
With endogenous $x_k$ and instruments $z=(x_{-k},z_k)$: the first stage \emph{must} regress $x_k$ on \emph{all} of $z$, not just $z_k$. Omitting $x_{-k}$ causes OVB in $\tilde\pi$, yielding $\hat\beta_k \pto \beta_k\pi/(\pi+\nu) \neq \beta_k$. Intuitively, $\hat{x}_k$ without controls captures variation from $x_{-k}$, which violates the ceteris paribus interpretation.

\subsection{LATE Interpretation}
With heterogeneous effects and binary $D,Z$, IV does not identify the ATE. Under \textbf{monotonicity} ($D_i(1)\geq D_i(0)$ $\forall i$, no defiers), the Wald estimand is the \textbf{LATE}:
\begin{align*}
    \frac{\E(Y|Z\!=\!1)-\E(Y|Z\!=\!0)}{\E(D|Z\!=\!1)-\E(D|Z\!=\!0)} = \E(y(1)\!-\!y(0)|\text{complier}).
\end{align*}
\textbf{Derivation:} Numerator $= \E(Y(1)\!-\!Y(0))$ by exogeneity. Always-takers/never-takers contribute zero ($D$ unchanged by $Z$); defiers ruled out. So numerator $= P(\text{c})\cdot\E(y(1)\!-\!y(0)|\text{c})$. Denominator $= P(\text{c})$. Ratio is the LATE.

\subsection{Hausman Test (Exogeneity)}
Test $H_0:\E(xu)=0$ using both OLS and IV. Under $H_0$, both are consistent; under $H_1$, only IV is. Joint distribution:
\begin{align*}
    \sqrt{n}\!\begin{pmatrix}\hat\beta_{\text{OLS}}-\beta\\\hat\beta_{\text{IV}}-\beta\end{pmatrix} \dto N(0,V_{\text{joint}}).
\end{align*}
Test statistic: $T_n = n(\hat\beta_{\text{IV}}-\hat\beta_{\text{OLS}})'\hat{W}^{-1}(\hat\beta_{\text{IV}}-\hat\beta_{\text{OLS}})\dto\chi^2_k$ under $H_0$, where $\hat{W}$ consistently estimates the variance of the difference.
